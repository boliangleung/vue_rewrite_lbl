{"version":3,"file":"vue.js","sources":["../../src/utils/index.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/compiler/index.js","../../src/observer/watcher.js","../../src/vdom/patch.js","../../src/lifecycle.js","../../src/init.js","../../src/vdom/create-element.js","../../src/render.js","../../src/index.js"],"sourcesContent":["export function isObject(data){\r\n\treturn typeof data ==='object'&&data!==null\r\n}\r\n// 判断是否被监听过 而且给key加上value值\r\nexport function def(data,key,value){\r\n\tObject.defineProperty(data,key,{\r\n\t\tenumerable:false,\r\n\t\tconfigurable:false,\r\n\t\tvalue\r\n\t})\r\n}\r\n// 相当于做了一层代理\r\nexport function proxy(vm,source,key){\r\n\t// 可以了解去 getthis.name的时候 回去触发 this._data.name的get.(一样会) 。 set也一样 也就会触发一开始我们的set 会通知watcher更新\r\n\tObject.defineProperty(vm,key,{\r\n\t\tenumrable:true,\r\n\t    configurable:true,\r\n\t    get(){\r\n\t    \treturn vm[source][key]\r\n\t    },\r\n\t    set(newVal){\r\n\t    \tvm[source][key]=newVal\r\n\t    }\r\n\t})\r\n}","\r\n// 需要重写一些会改变数组自身的方法 push shift pop unshift splice sort filter\r\n// 记得 不监控索引和不监控长度的\r\nlet oldArrayMethods = Array.prototype\r\nimport {def} from \"../utils/index\"\r\n// value._proto_ = arrayMethods\r\n// arrayMethods._proto_ = oldArrayMethods\r\n// 首先会找aarayMethods 如果不存在 会查找oldArrayMethods 所以这是原型链查找的问题重写的没有 会继续向上查找\r\nexport let arrayMethods=Object.create(oldArrayMethods);\r\nconst methods=['push','shift','unshift','pop','splice','sort','filter'];\r\nmethods.forEach(method=>{\r\n\t\r\n\tdef(arrayMethods,method,function(...args){\r\n\t\t//console.log('用户调用了push方法') // 这相当 切片方程   相当于在原生的逻辑切了个片，然后把这个片塞到了新写的方法里面返回\r\n\r\n\t\tconst result = oldArrayMethods[method].apply(this,args) // 实际上是调用原生的数组方法\r\n\t\tlet ob = this.__ob__\r\n\t\t// push unshift splice 添加的元素可能是一个新的元素\r\n\t\tlet inserted ;//用户输入的参数\r\n\t\tswitch(method){\r\n\t\t\tcase 'push':\r\n\t\t\tcase 'unshift':\r\n\t\t\tinserted = args;\r\n\t\t\tbreak;\r\n\t\t\tcase 'splice':   // 3个参数  第一个是删除的位置 第二个是 删除的数量  第三个 新增的属性\r\n\t\t\tinserted = args.slice(2)\r\n\t\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\t// 因为监听方法 我们之前封装在了 observe 我们现在的this 是 value 所以我们想办法 把new Observer 放在value的一个属性 那么我们就可以调用observerArray了\r\n\t\tif(inserted)  ob.observerArray(inserted) // 将新增属性一直检测。\r\n\r\n\t\treturn result\r\n\t}) \r\n})","import {isObject,def} from \"../utils/index\"\r\nimport {arrayMethods} from \"./array.js\"\r\n\r\n// ?为什么单独写类\r\n// 如果要delete 内部是使用 vm.$delete 原理是splice\r\n// 可以通过设置 __ob__ 判断它是不是一个已经监测过的类\r\nclass Observer{\r\n\tconstructor(value){ // 仅仅初始化功能\r\n\t\t// vue如果数据的层次过多 需要递归的去解析对象中的属性，依次增加set和get方法 性能并不是特别好\r\n\t\t// vue3.0 使用了proxy 并不用递归地去解析 而且不用加set和get方法\r\n\r\n\t\t// value.__ob__ =this  // 我给每一个监控过的对象都增加一个__ob__属性 可以描述这个对象已经被监控过了\r\n\t\t// 如果像上面那样写 会死循环 因为下面会不断的遍历__ob__ 所以得设置成不可枚举的属性。\r\n\t\tdef(value,'__ob__',this)\r\n\r\n\t\t// 需要对数组和对象分开监测 如果数组走walk 那么索引也会被监测 这并不是我们想要的。 console.log 可以看到\r\n\t\tif(Array.isArray(value)){\r\n\t\t\t// 如果是数组的话 并不会对索引进行观测 因为会导致性能问题\r\n\t\t\t// 前端是很少操作索引的 一般是 push pop ...7个方法\r\n\t\t\t// 所以我们需要做一个函数劫持 重写原型的方法 当数组调用这几个方法的时候 通知更新\r\n\t\t\tvalue['__proto__'] = arrayMethods\r\n\t\t\t// 这种模式 装修者模式 或者代理模式  arrayMethods 可以去调原生的方法 中间的时候 可以通知更新\r\n\t\t\t// 如果数组里面放的是对象 我们再监控\r\n\t\t\tthis.observerArray(value)\r\n\t\t}else{\r\n\t\t\tthis.walk(value)\r\n\t\t}\r\n\t\t// 观测的话 就两种方式 1种是数组 一种是对象\r\n\t\t// 如果是数组的话 我们还把原型的方法重写。 然后对数组里面的每一项进行监控。\r\n\t\t// 把这些方法 重新定义到了我们自己封装的方法。\r\n\t\t// 如果是对象的话 就对对象的属性通过Object.defineProperty进行重新定义。\r\n\t}\r\n\twalk(data){\r\n\t\tlet keys = Object.keys(data); //[name,detail]\r\n\t\tfor(let i=0;i<keys.length;i++){\r\n\t\t\tlet key = keys[i]\r\n\t\t\tlet value = data[key];\r\n\t\t\tdefineReactive(data,key,value) // Vue 核心响应式方法\r\n\t\t}\r\n\t}\r\n\tobserverArray(data){\r\n\t\tfor(let i=0;i<data.length;i++){\r\n\t\t\tobserve(data[i])\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction defineReactive(data,key,value){\r\n\tobserve(value)\r\n\tObject.defineProperty(data,key,{\r\n\t\tenumrable:true,\r\n\t    configurable:true,\r\n\t    get(){\r\n\t    \treturn value\r\n\t    },\r\n\t    set(newVal){\r\n\t    \tif(newVal ===value) return;\r\n\t    \tobserve(newVal) // 继续劫持用户设置的值，因为有可能设置的值是一个对象\r\n\t    \tvalue = newVal  // 利用闭包的特性\r\n\t    }\r\n\t})\r\n}\r\n\r\n// 把data中的数据 都使用Object.defineProperty重新定义\r\n// 不能兼容IE8以下\r\nexport function observe(data){\r\n\tif(!isObject(data)){\r\n\t\treturn  \r\n\t}\r\n\treturn new Observer(data)  //用来观察数组\r\n}","import {observe} from \"./observer/index\"\r\nimport {proxy} from \"./utils/index\"\r\nexport function initState(vm){\r\n\tconst opts = vm.$options\r\n\t// 初始化Vue的数据来源 props methods data computed watch 顺序 Vue 源码也是这样的顺序\r\n\tif(opts.props){\r\n\t\tinitProps(vm)\r\n\t}\r\n\tif(opts.methods){\r\n\t\tinitMethod(vm)\r\n\t}\r\n\tif(opts.data){\r\n\t\tinitData(vm)\r\n\t}\r\n\tif(opts.computed){\r\n\t\tinitComputed(vm)\r\n\t}\r\n\tif(opts.watch){\r\n\t\tinitWatch(vm)\r\n\t}\r\n}\r\nfunction initProps(vm){\r\n\r\n}\r\nfunction initMethod(vm){\r\n\r\n}\r\nfunction initData(vm){\r\n\tlet data = vm.$options.data // 用户传的data\r\n\tdata = vm._data = typeof data ==='function'?data.call(vm):data  //处理data\r\n\t// 对象劫持 用户改变了数据 我们希望可以得到通知 => 刷新\r\n\t// MVVM模式 数据变化驱动视图变化\r\n\t// Object.defineProperty()给属性添加get方法和set方法\r\n\r\n\t// 为了让用户更好的使用 用户可以使用this.xx 使用代理\r\n\tfor(let key in data){\r\n\t\tproxy(vm,'_data',key)\r\n\t}\r\n\tobserve(data);\r\n}\r\nfunction initComputed(vm){\r\n\r\n}\r\nfunction initWatch(vm){\r\n\r\n}\r\n","﻿\r\n// ast语法树 是用对象来描述原生语法的  虚拟DOM 用对象来描述DOM节点的\r\n\r\n// ?:匹配不捕获\r\n// arguments[0] 匹配到的标签 arguments[1] 匹配到的标签名字\r\n\r\n// 这个也是参考JQ之父写的一个项目源码\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // abc-aa\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是 标签名 \r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div> \r\n// ID=\"abc\"(3)  'abc'(4) 'ab'(5) //可能捕获到的结果\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+| ([^\\s\"'=<>`]+)))?/; // 匹配属性的 \r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >\r\nconst defaultTagRE = /\\{\\{((?:.|\\n)+?)\\}\\}/g   // 匹配{{}}\r\n\r\nlet root=null; // 树根\r\nlet currentParent; //保存当前父亲 渲染div 父亲就是空 渲染P 父亲是div  标识当前父亲是谁\r\nlet stack=[];\r\n// 类型\r\nconst ELEMENT_TYPE=1;\r\nconst TEXT_TYPE=3;\r\n// <div><p>//要知道父子关系\r\n// [div,p,span,] 语法是否正确 使用栈的原理 进行匹配\r\n\r\nfunction createASTElement(tagName,attrs){\r\n\treturn {\r\n\t\ttag:tagName,\r\n\t\tattrs,\r\n\t\ttype:ELEMENT_TYPE,\r\n\t\tchildren:[],\r\n\t\tparent:null\r\n\t}\r\n}\r\n\r\nfunction start(tagName,attrs){\r\n\t// console.log(\"开始标签是：\",tagName,\"属性是:\",attrs)\r\n\r\n\t// 遇到开始标签 创建一个ast元素\r\n\tlet element=createASTElement(tagName,attrs);\r\n\tif(!root){ //因为只有一个DOM结点\r\n\t\troot=element\r\n\t}\r\n\tcurrentParent = element;// 把当前元素标记成父ast树\r\n\tstack.push(element)  // 将开始标签放到栈中 是放element 不是标签名\r\n}\r\n\r\nfunction chars(text){\r\n\t// 去掉空字符串\r\n\ttext=text.replace(/\\s/g,'');\r\n\tif(text){\r\n\t\tcurrentParent.children.push({\r\n\t\t\ttext,\r\n\t\t\ttype:TEXT_TYPE\r\n\t\t})\r\n\t}\r\n\t// console.log('文本是:',text)\r\n}\r\nfunction end(tagName){\r\n\t// <div><p>//要知道父子关系\r\n\t// console.log(tagName)\r\n\tlet element = stack.pop()\r\n\t// 标识当前这个P是属于这个div的儿子的\r\n\tcurrentParent = stack[stack.length-1];\r\n\t// 如果存在 因为最后一个标签的话 可能呢是空的\r\n\t// 如果存在 那么该元素的父亲就是currentParent \r\n\t// 父亲的子节点就是这个element\r\n\t// 特殊标签 暂时不做考虑 比如a标签\r\n\tif(currentParent){\r\n\t\t// 实现了一个树的父子关系\r\n\t\telement.parent = currentParent\r\n\t\tcurrentParent.children.push(element)\r\n\t}\r\n\t// 只能在关闭的时候 才可以确认父子关系 一开始是不可以的\r\n\t// 比如 div p span\r\n}\r\n\r\n\r\n\r\n\r\n// 核心规则 就是不停地去拿这些正则去匹配当前的字符串 每匹配到一段字符串 我们就截取字符串\r\n// 正则匹配 加循环 解析成AST语法树\r\nfunction parseHTML(html){\r\n\t// 不停地去解析\r\n\twhile(html){\r\n\t\tlet textEnd = html.indexOf('<');\r\n\t\tif(textEnd==0){\r\n\t\t\t// 如果当前索引为0 肯定是一个标签 开始标签或者结束标签\r\n\t\t\tlet startTagMatch = parseStartTag(); // 通过这个方法获取到匹配的结果 tagName,attrs\r\n\t\t\tif(startTagMatch){\r\n\t\t\t\tstart(startTagMatch.tagName,startTagMatch.attrs)  // 1.得到开始标签和结果是就要开始解析标签\r\n\t\t\t\tcontinue;\r\n\t\t\t\t// 如果开始标签匹配完之后 继续下一次匹配\r\n\t\t\t}\r\n\t\t\tlet endTagMatch=html.match(endTag)\r\n\t\t\tif(endTagMatch){\r\n\t\t\t\tadvance(endTagMatch[0].length);\r\n\t\t\t\tend(endTagMatch[1])\t\t// 2. 解析结束标签\r\n\t\t\t\tcontinue;\r\n\t\t\t}\t\r\n\t\t}\r\n\t\tlet text;\r\n\t\t// 去掉div之后 下一行 一开始可能是空字符串 或者字符串 我们需要截取做处理\r\n\t\tif(textEnd>=0){\r\n\t\t\ttext = html.substring(0,textEnd)  \r\n\t\t}\r\n\t\t// 前进文本的位置\r\n\t\tif(text){\r\n\t\t\tadvance(text.length)\r\n\t\t\tchars(text)   // 3.解析文本\r\n\t\t}\r\n\r\n\t}\r\n\t// 前进多少位 也就是截取\r\n\tfunction advance(n){\r\n\t\thtml = html.substring(n);\r\n\t}\r\n\tfunction parseStartTag(){\r\n\t\tlet start = html.match(startTagOpen)\r\n\t\t// console.log(start)\r\n\t\t// [\"<div\", \"div\", index: 0, xx]  \r\n\t\t// 所以我们需要截取第一个<div\r\n\t\tif(start){\r\n\t\t\tconst  match={\r\n\t\t\t\ttagName:start[1],\r\n\t\t\t\tattrs:[]\r\n\t\t\t}\r\n\t\t\tadvance(start[0].length) // 将匹配到的标签从HTML删除\r\n\t\t\tlet end,attr;\r\n\t\t\t// 判断能否匹配到结束标签 匹配结束标签之前的数据 就是属性\r\n\t\t\t// 没有匹配到结束标签 且 attr匹配到了属性 就把这个属性添加到match 并在html删除该字符串\r\n\t\t\twhile( !(end = html.match(startTagClose))&&(attr = html.match(attribute))){\r\n\t\t\t\t// 将属性进行解析\r\n\t\t\t\tadvance(attr[0].length)\r\n\t\t\t\tmatch.attrs.push({name:attr[1],value:attr[3]||attr[4]||attr[5]}) // 第二个是 = 第三个是值 双引号 第四个单引号 第五个是没有符号\r\n\t\t\t}\r\n\t\t\tif(end){ //去掉开始标签\r\n\t\t\t\tadvance(end[0].length)\r\n\t\t\t}\r\n\t\t\treturn match\r\n\t\t}\r\n\t}\r\n\t// 最终会生成一个AST树\r\n\treturn root\r\n}\r\n//处理attrs 生成我们想要的字符串\r\nfunction genProps(attrs){\r\n\tconsole.log(attrs)\r\n\tlet str=\"\"\r\n\tfor(let i=0;i<attrs.length;i++){\r\n\t\tlet attr = attrs[i]\r\n\t\tif(attr.name===\"style\"){\r\n\t\t\t// style=\"color:red;\"=>style:{color:red,} => 最后再加{}\r\n\t\t\tlet  obj={}\r\n\t\t\tattr.value.split(';').forEach(item=>{\r\n\t\t\t\tlet [key,value] = item.split(':');\r\n\t\t\t\tobj[key] = value\r\n\t\t\t});\r\n\t\t\t// 重写style value的值\r\n\t\t\tattr.value=obj;\r\n\t\t}\r\n\t\t// JSON.stringify 用来解析{color:red 要不然解析不了}\r\n\t\tstr += `${attr.name}:${JSON.stringify(attr.value)},`\r\n\t}\r\n\treturn `{${str.slice(0,-1)}}` //最后一个逗号不要\r\n}\r\nfunction genChildren(el){\r\n\tlet children  = el.children\r\n\tif(children.length>0){\r\n\t\treturn `${children.map(c => gen(c)).join(',')}`\r\n\t}else{\r\n\t\treturn false\r\n\t}\r\n}\r\nfunction generate(el){\r\n\tlet children = genChildren(el)\r\n\tlet code=``\r\n\treturn `_c(\"${el.tag}\",${\r\n\t\tel.attrs.length>0?genProps(el.attrs):'undefined'\r\n\t}${children?`,${children}`:''})`\r\n}\r\nfunction gen(node){\r\n\tif(node.type===1){\r\n\t\t//元素标签\r\n\t\treturn generate(node)\r\n\t}else{\r\n\t\tlet text =node.text; //a  {{name}}  b {{age}}  c \r\n\t\tlet tokens=[];\r\n\t\tlet match,index;\r\n\t\t// 每次的偏移量\r\n\t\tlet lastIndex = defaultTagRE.lastIndex=0; // 正则的坑 当他匹配一次之后 lastIndex的索引问题 \r\n\t\t// 只要是全局匹配 就需要将lastIndex每次匹配的lastIndex调到0处。 \r\n\t\t// /abc/.test('a') 第二次的话 就是false 所以需要重置\r\n\t\twhile(match=defaultTagRE.exec(text)){\r\n\t\t\tindex = match.index\r\n\t\t\tif(index>lastIndex){  //比较匹配到的值上次的值 \r\n\t\t\t\ttokens.push(JSON.stringify(text.slice(lastIndex,index)))// 相当于截取a  这段\r\n\t\t\t}\r\n\t\t\ttokens.push(`_s(${match[1].trim()})`); //{{name}}\r\n\t\t\tlastIndex=index+match[0].length; //记录用\r\n\t\t}\r\n\t\tif(lastIndex<text.length){\r\n\t\t\ttokens.push(JSON.stringify(text.slice(lastIndex)))// 最后一次 c 没有匹配到\r\n\t\t}\r\n\t\t\r\n\t\treturn `_v(${tokens.join('+')})`\r\n\t}\r\n}\r\n\r\nexport function compileToFunction(template){\r\n\t// 1. 解析HTML成AST语法树\r\n\tlet root = parseHTML(template)\r\n\r\n\t// 2. 需要将ast语法树生成最终的render函数  核心逻辑 字符串拼接  \r\n\r\n\tlet code = generate(root)\r\n\t\t// <div id=\"app\">\r\n\t\t// <p>{{name}}</p>\r\n\t\t// <span>{{age}}</span>\t\r\n\t\t// </div>\r\n\t\t// _c 创建结点 _s 创建字符串(原理是JSON.stringify) _v 创建文本\r\n\t\t// 最终结果 将ast树 再次转化成JS语法。\r\n\t\t// 开发时候 我们并不会去使用这样的一个模板 因为这样 很浪费性能。\r\n\t\t// render return _c('div',{id:app},_c('p',undefined,_v(_s(name))),_c('span',undefined,_v(_s(age))))\r\n\r\n\t// 3. 生成函数 所有模板的引擎实现 都需要new Function + with\r\n\t// with(this._data){\r\n\t// \t//这里的变量 可以取this._data这个作用域下的值。 \r\n\t// \tconsole.log(name)\r\n\t// }\r\n\tcode = `with(this){return ${code}}`\r\n\tlet renderFn = new Function(code)\r\n\t// vm._render 就是这样的实现\r\n\r\n\t// Vue的_render 是返回虚拟DOM的\r\n\treturn renderFn;\r\n\t// console.log(root)\r\n\t// console.log(renderFn)\r\n}\r\n\r\n\r\n/**\r\nnodeType =1 文档元素 nodeType = 3文本类型\r\n\r\n分析 start div attrs:[{name:\"id\",\"value:\"app\"}]\r\n\tstart  p\r\n\ttext {{name}}\r\n\tend   p\r\n\tstart span\r\n\ttext {{age}}\r\n\tend  span\r\n\tend div\r\n这个过程 就是截取字符串 抽出来当成ast语法树\r\n\t <div id=\"app\">\r\n\t\t<p>{{name}}</p>\r\n\t\t<span>{{age}}</span>\t\r\n\t </div>\r\n\r\n\r\n\t转成AST语法树\r\nlet root =｛\r\n\ttag:'div',\r\n\tattrs:[{name:id,value:\"app\"}],\r\n\tparent:null,\r\n\ttype:1,\r\n\tchildren:[{\r\n\t\ttag:'p',\r\n\t\tattrs:[],\r\n\t\tparent:root,\r\n\t\ttype:1,\r\n\t\tchildren:[{\r\n\t\t\ttext:\"{{name}}\",\r\n\t\t\ttype:3\r\n\t\t}]\r\n\t}]\r\n ｝\r\n\r\n 不能有多个根节点 因为要做diff操作，diff操作是从树根开始 你不可能有两个树根。\r\n\r\n 使用 const compiler = require(Vue-template-compiler) 包\r\n\r\n let r = compiler.compiler(\"<div></div>\")\r\n**/","import Dep, { pushTarget } from './dep'\r\n\r\nclass Watcher {\r\n  constructor(vm, exprorFn, cb, options) {\r\n    // 传进来的对象\r\n    this.vm = vm\r\n\r\n    // 在Vue中cb是更新视图的核心，调用diff并更新视图过程\r\n    this.cb = cb\r\n    // 收集Deps 用于移除监听\r\n    this.newDeps = []\r\n    this.getter = exprorFn //将内部传过来的的回调函数 放到getter属性上 执行回调函数\r\n\r\n    this.options = options\r\n\r\n    //设置Dep.target的值，依赖收集时watch 对象\r\n    this.value = this.get()\r\n  }\r\n  get() {\r\n    // 设置Dep.target值 用于依赖收集\r\n    pushTarget(this)\r\n    const vm = this.vm\r\n    let value = this.getter.call(vm, vm)\r\n    return value\r\n  }\r\n  //添加依赖\r\n  addDep(dep) {\r\n    //  这里简单处理，在VUE中 做了重复筛选，即依赖只收集一次，不重复收集依赖\r\n    this.newDeps.push(dep)\r\n    dep.addSub(this)\r\n  }\r\n  // 更新\r\n  update() {\r\n    this.run()\r\n  }\r\n  run() {\r\n    //这里只做简单的console.log 处理，在Vue中会调用diff过程从而更新视图\r\n    console.log(`这里会去执行Vue的diff相关方法，进而更新数据`)\r\n  }\r\n}\r\nexport default Watcher\r\n","export function patch(oldVode,vnode){\r\n\tconsole.log(oldVode,vnode)\r\n\t//vnode 和ast抽象树很像 但是真实的情况下 我们还有v-model v-for 事件等等等情况 ast抽象树并不能生成真实的代码\r\n\r\n\t// 1. 判断是更新还是渲染\r\n\tconst isRealElement=oldVode.nodeType;\r\n\tif(isRealElement){\r\n\t\tconst oldElm = oldVode // div id=app\r\n\t\tconst parentElm = oldElm.parentNode; //body 要把虚拟节点放到\r\n\r\n\t\tlet el=createElm(vnode)\r\n\t\tparentElm.insertBefore(el,oldElm.nextSibling) //插入在老元素的ID之后 紧随那种 不能用append 要不然会在最后\r\n\t\tparentElm.removeChild(oldElm) // 删除老结点\r\n\t\treturn el;\r\n\t}\r\n\r\n\t// 递归创建真实结点 替换掉老的结点。\r\n}\r\nfunction createElm(vnode){\r\n\tlet {tag,data,key,children,text}=vnode\r\n\t//是标签 就创建标签\r\n\tif(typeof tag==='string'){\r\n\t\tvnode.el=document.createElement(tag);\r\n\t\tupdateProperties(vnode);\r\n\t\tchildren.forEach(child=>{ //递归创建儿子节点，将儿子节点扔到父节点上。\r\n\t\t\treturn vnode.el.appendChild(createElm(child))\r\n\t\t})\r\n\t}else{\r\n\t\t//虚拟DOM上映射着真实DOM 方便后续更新操作\r\n\t\tvnode.el=document.createTextNode(text)\r\n\t}\r\n\treturn vnode.el // 记得是有返回值的\r\n\t// 如果不是标签 就是文本\r\n}\t\r\n// 更新属性的值\r\nfunction updateProperties(vnode){\r\n\tlet newProps = vnode.data ||{}\r\n\tlet el = vnode.el\r\n\r\n\tfor(let key in newProps){\r\n\t\tif(key==='style'){\r\n\t\t\tfor(let styleName in newProps.style){\r\n\t\t\t\tel.style[styleName]=newProps.style[styleName]\r\n\t\t\t}\r\n\t\t}else if(key==='class'){\r\n\t\t\tel.className =newProps.class\r\n\t\t}else{\r\n\t\t\tel.setAttribute(key,newProps[key])\r\n\t\t}\r\n\t}\r\n}","import Watcher from \"./observer/watcher\"\r\nimport {patch} from \"./vdom/patch\"\r\nexport function lifecyleMixin(Vue){\r\n\tVue.prototype._update=function(vnode){\r\n\t\tconst vm=this\r\n\t\t// 通过虚拟节点 渲染出真实的DOM\r\n\t\t// console.log(vnode)\r\n\t\tvm.$el=patch(vm.$el,vnode)  //需要用虚拟节点创建出真实结点 替换掉真实的$el\r\n\t\t// patch 也是更新的 判断diff的一部分\r\n\r\n\t}\r\n}\r\n\r\nexport function mountComponent(vm,el){\r\n\tconst options = vm.$options //render\r\n\tvm.$el =el;//真实的元素\r\n\r\n\t// watcher 就是用来渲染的\r\n\t// vm._render 通过解析render方法 渲染出虚拟DOM\r\n\t// vm._update 通过虚拟DOM 创建珍惜结点\r\n\r\n\t// 渲染页面\r\n\tlet updateComponent=()=>{ //无论渲染还是更新 都会调用此方法\r\n\t\t// 返回的是虚拟DOM_render\r\n\t\tvm._update(vm._render())\r\n\t}\r\n\t// 渲染watcher 每一个组件都有一个watcher  渲染watcher 不需要通知谁 所以第三个是一个空函数\r\n\tnew Watcher(vm,updateComponent,()=>{},true) //true标识他是一个渲染watcher\r\n\t// 一个组件只有一个渲染watcher\r\n}","\r\nimport {initState} from \"./state\"\r\nimport {compileToFunction} from \"./compiler/index\"\r\nimport {mountComponent} from \"./lifecycle\"\r\n\r\nexport  function initMixin(Vue){\r\n\t// 在原型上添加一个init方法  初始化流程\r\n\tVue.prototype._init = function(options){\r\n\t\t// 做数据的劫持\r\n\t\tconst vm=this\r\n\t\tvm.$options = options // this.$options就是用户传的属性\r\n\r\n\t\t// 初始化状态\r\n\t\tinitState(vm) // 分割代码\r\n\r\n\r\n\t\t// 如果页面传入el属性 需要将页面渲染出来。\r\n\t\t// 如果页面传入了el 我们就要实现挂载\r\n\t\t// 编译过程\r\n\t\tif(vm.$options.el){\r\n\t\t\tvm.$mount(vm.$options.el)\r\n\t\t}\r\n\t}\r\n\r\n\tVue.prototype.$mount=function(el){\r\n\t\tconst vm = this;\r\n\t\tconst options = vm.$options\r\n\t\tel = document.querySelector(el)\r\n\t\t// 默认先会查找有没有render方法，没有render 会采用tempalate template也没有 就用el中的内容\r\n\t\tif(!options.render){\r\n\t\t\t// 对模板进行编译\r\n\t\t\tlet template = options.template; // 取出模板\r\n\t\t\tif(!template&&el){\r\n\t\t\t\ttemplate = el.outerHTML\r\n\t\t\t}\r\n\t\t\t// console.log(template)\r\n\t\t\tconst render = compileToFunction(template)\r\n\r\n\t\t\toptions.render = render\r\n\t\t\t// 我们需要将template 转化成render方法 vue1.0 2.0 虚拟DOM 就可以用DOM DIFF的操作\r\n\t\t\t// <div id=\"app\">\r\n\t\t\t// <p>{{name}}</p>\r\n\t\t\t// <span>{{age}}</span>\t\r\n\t\t\t// </div>\r\n\t\t\t// _c 创建结点 _s 创建字符串(原理是JSON.stringify) _v 创建文本\r\n\t\t\t// render return _c('div',{id:app},_c('p',undefined,_v(_s(name))),_c('span',undefined,_v(_s(age))))\r\n\t\t\t// eval 不安全 因为 \r\n\t\t\t// let a=1;\r\n\t\t\t// eval(`console.log(a)`) 它会往上级作用域找 不干净 函数作用域是不会的。 \r\n\t\t}\r\n\t\t// 最终都是要得到 options.render\r\n\t\t// 渲染当前的组件 挂载这个组件\r\n\t\tmountComponent(vm,el) // vm上的render 执行后的结果 替换el就可以了。\r\n\t}\r\n}","export function createElement(tag,data={},...children){\r\n\tlet key=data.key\r\n\tif(key){\r\n\t\tdelete data.key;\r\n\t}\r\n\treturn vnode(tag,data,key,children,undefined)\r\n\t// console.log(tag,data,children)\r\n\t\r\n}\r\nexport function createTextNode(text){\r\n\treturn vnode(undefined,undefined,undefined,undefined,text)\r\n}\r\n\r\n// 虚拟DOM节点 就是通过_c -v 实现用对象来描述DOM节点的结构 （实际还是对象）\r\n\r\nfunction vnode(tag,data,key,children,text){\r\n\treturn {\r\n\t\ttag,\r\n\t\tdata,\r\n\t\tkey,\r\n\t\tchildren,\r\n\t\ttext\r\n\t}\r\n}\r\n// 当然vnode 我们以后也是可以扩展的 比如componentOptions等等\r\n\r\n// 1. 将template转化成ast语法书--》生成render方法--》生成虚拟DOM---》真实DOM\r\n// 更新过程  重新生成虚拟DOM -》 diff->更新DOM\r\n\r\n// 第一次生成了ast ->render 函数。 更新的时候 我们直接获取render函数 进行值的更新 就可以生成vnode 然后和之前的做比较\r\n\r\n// 就比如components的vnode 就还有componentOptions和element这个结点。其实都是大同小异。","import {createElement,createTextNode} from \"./vdom/create-element\"\r\n\r\n\r\nexport function renderMixin(Vue){\r\n\t// _c 创建元素的虚拟节点\r\n\t// _v 创建文本的虚拟节点\r\n\t// _s JSON.stringify\r\n\t// 里面的_c =》this._c\r\n\tVue.prototype._c=function(){\r\n\t\treturn createElement(...arguments);//tag,data,children1,children2\r\n\t}\r\n\tVue.prototype._v=function(text){\r\n\t\treturn createTextNode(text)\r\n\t}\r\n\tVue.prototype._s=function(val){\r\n\t\treturn val==null?'':(typeof val==='object'?JSON.stringify(val):val);\r\n\t}\r\n\tVue.prototype._render=function(){\r\n\t\tconst vm=this\r\n\r\n\t\tconst {render} = vm.$options\r\n\r\n\t\tlet vnode =  render.call(vm);// 去实例上取值 \r\n\t\treturn vnode\r\n\t}\r\n}","\r\n/**\r\n *@title Vue rewrite\r\n *\r\n**/\r\n// 这个文件只是整合的功能\r\nimport {initMixin} from \"./init\"\r\nimport {renderMixin} from \"./render\"\r\nimport {lifecyleMixin} from \"./lifecycle\"\r\n\r\nfunction Vue(options){\r\n\t// 必须new 实例化\r\n\tif(!this instanceof Vue){\r\n\t\tnew Error(\"Vue should be instantiated use 'vew' \")\r\n\t\treturn\r\n\t}\r\n\t// 进行Vue的初始化工作\r\n\tthis._init(options)\r\n}\r\n// 通过引入文件的方式 给Vue原型上添加方法\r\ninitMixin(Vue)\r\nrenderMixin(Vue)\r\nlifecyleMixin(Vue)\r\n\r\nexport default Vue"],"names":["isObject","data","def","key","value","Object","defineProperty","enumerable","configurable","proxy","vm","source","enumrable","get","set","newVal","oldArrayMethods","Array","prototype","arrayMethods","create","methods","forEach","method","args","result","apply","ob","__ob__","inserted","slice","observerArray","Observer","isArray","walk","keys","i","length","defineReactive","observe","initState","opts","$options","props","initData","computed","watch","_data","call","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","defaultTagRE","root","currentParent","stack","ELEMENT_TYPE","TEXT_TYPE","createASTElement","tagName","attrs","tag","type","children","parent","start","element","push","chars","text","replace","end","pop","parseHTML","html","textEnd","indexOf","startTagMatch","parseStartTag","endTagMatch","match","advance","substring","n","attr","name","genProps","console","log","str","obj","split","item","JSON","stringify","genChildren","el","map","c","gen","join","generate","node","tokens","index","lastIndex","exec","trim","compileToFunction","template","code","renderFn","Function","Watcher","exprorFn","cb","options","newDeps","getter","dep","addSub","run","patch","oldVode","vnode","isRealElement","nodeType","oldElm","parentElm","parentNode","createElm","insertBefore","nextSibling","removeChild","document","createElement","updateProperties","child","appendChild","createTextNode","newProps","styleName","style","className","setAttribute","lifecyleMixin","Vue","_update","$el","mountComponent","updateComponent","_render","initMixin","_init","$mount","querySelector","render","outerHTML","undefined","renderMixin","_c","arguments","_v","_s","val"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAO,SAASA,QAAT,CAAkBC,IAAlB,EAAuB;EAC7B,SAAO,QAAOA,IAAP,MAAe,QAAf,IAAyBA,IAAI,KAAG,IAAvC;EACA;;EAEM,SAASC,GAAT,CAAaD,IAAb,EAAkBE,GAAlB,EAAsBC,KAAtB,EAA4B;EAClCC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA2BE,GAA3B,EAA+B;EAC9BI,IAAAA,UAAU,EAAC,KADmB;EAE9BC,IAAAA,YAAY,EAAC,KAFiB;EAG9BJ,IAAAA,KAAK,EAALA;EAH8B,GAA/B;EAKA;;EAEM,SAASK,KAAT,CAAeC,EAAf,EAAkBC,MAAlB,EAAyBR,GAAzB,EAA6B;EACnC;EACAE,EAAAA,MAAM,CAACC,cAAP,CAAsBI,EAAtB,EAAyBP,GAAzB,EAA6B;EAC5BS,IAAAA,SAAS,EAAC,IADkB;EAEzBJ,IAAAA,YAAY,EAAC,IAFY;EAGzBK,IAAAA,GAHyB,iBAGpB;EACJ,aAAOH,EAAE,CAACC,MAAD,CAAF,CAAWR,GAAX,CAAP;EACA,KALwB;EAMzBW,IAAAA,GANyB,eAMrBC,MANqB,EAMd;EACVL,MAAAA,EAAE,CAACC,MAAD,CAAF,CAAWR,GAAX,IAAgBY,MAAhB;EACA;EARwB,GAA7B;EAUA;;ECvBD;EACA;EACA,IAAIC,eAAe,GAAGC,KAAK,CAACC,SAA5B;EAGA;EACA;;EACO,IAAIC,YAAY,GAACd,MAAM,CAACe,MAAP,CAAcJ,eAAd,CAAjB;EACP,IAAMK,OAAO,GAAC,CAAC,MAAD,EAAQ,OAAR,EAAgB,SAAhB,EAA0B,KAA1B,EAAgC,QAAhC,EAAyC,MAAzC,EAAgD,QAAhD,CAAd;EACAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAE;EAEvBrB,EAAAA,GAAG,CAACiB,YAAD,EAAcI,MAAd,EAAqB,YAAiB;EAAA,sCAALC,IAAK;EAALA,MAAAA,IAAK;EAAA;;EACxC;EAEA,QAAMC,MAAM,GAAGT,eAAe,CAACO,MAAD,CAAf,CAAwBG,KAAxB,CAA8B,IAA9B,EAAmCF,IAAnC,CAAf,CAHwC;;EAIxC,QAAIG,EAAE,GAAG,KAAKC,MAAd,CAJwC;;EAMxC,QAAIC,QAAJ,CANwC;;EAOxC,YAAON,MAAP;EACC,WAAK,MAAL;EACA,WAAK,SAAL;EACAM,QAAAA,QAAQ,GAAGL,IAAX;EACA;;EACA,WAAK,QAAL;EAAiB;EACjBK,QAAAA,QAAQ,GAAGL,IAAI,CAACM,KAAL,CAAW,CAAX,CAAX;EAND,KAPwC;;;EAkBxC,QAAGD,QAAH,EAAcF,EAAE,CAACI,aAAH,CAAiBF,QAAjB,EAlB0B;;EAoBxC,WAAOJ,MAAP;EACA,GArBE,CAAH;EAsBA,CAxBD;;ECNA;EACA;;MACMO;EACL,oBAAY5B,KAAZ,EAAkB;EAAA;;EAAE;EACnB;EACA;EAEA;EACA;EACAF,IAAAA,GAAG,CAACE,KAAD,EAAO,QAAP,EAAgB,IAAhB,CAAH,CANiB;;EASjB,QAAGa,KAAK,CAACgB,OAAN,CAAc7B,KAAd,CAAH,EAAwB;EACvB;EACA;EACA;EACAA,MAAAA,KAAK,CAAC,WAAD,CAAL,GAAqBe,YAArB,CAJuB;EAMvB;;EACA,WAAKY,aAAL,CAAmB3B,KAAnB;EACA,KARD,MAQK;EACJ,WAAK8B,IAAL,CAAU9B,KAAV;EACA,KAnBgB;EAqBjB;EACA;EACA;;EACA;;;;2BACIH,MAAK;EACT,UAAIkC,IAAI,GAAG9B,MAAM,CAAC8B,IAAP,CAAYlC,IAAZ,CAAX,CADS;;EAET,WAAI,IAAImC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACD,IAAI,CAACE,MAAnB,EAA0BD,CAAC,EAA3B,EAA8B;EAC7B,YAAIjC,GAAG,GAAGgC,IAAI,CAACC,CAAD,CAAd;EACA,YAAIhC,KAAK,GAAGH,IAAI,CAACE,GAAD,CAAhB;EACAmC,QAAAA,cAAc,CAACrC,IAAD,EAAME,GAAN,EAAUC,KAAV,CAAd,CAH6B;EAI7B;EACD;;;oCACaH,MAAK;EAClB,WAAI,IAAImC,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACnC,IAAI,CAACoC,MAAnB,EAA0BD,CAAC,EAA3B,EAA8B;EAC7BG,QAAAA,OAAO,CAACtC,IAAI,CAACmC,CAAD,CAAL,CAAP;EACA;EACD;;;;;;EAGF,SAASE,cAAT,CAAwBrC,IAAxB,EAA6BE,GAA7B,EAAiCC,KAAjC,EAAuC;EACtCmC,EAAAA,OAAO,CAACnC,KAAD,CAAP;EACAC,EAAAA,MAAM,CAACC,cAAP,CAAsBL,IAAtB,EAA2BE,GAA3B,EAA+B;EAC9BS,IAAAA,SAAS,EAAC,IADoB;EAE3BJ,IAAAA,YAAY,EAAC,IAFc;EAG3BK,IAAAA,GAH2B,iBAGtB;EACJ,aAAOT,KAAP;EACA,KAL0B;EAM3BU,IAAAA,GAN2B,eAMvBC,MANuB,EAMhB;EACV,UAAGA,MAAM,KAAIX,KAAb,EAAoB;EACpBmC,MAAAA,OAAO,CAACxB,MAAD,CAAP,CAFU;;EAGVX,MAAAA,KAAK,GAAGW,MAAR,CAHU;EAIV;EAV0B,GAA/B;EAYA;EAGD;;;EACO,SAASwB,OAAT,CAAiBtC,IAAjB,EAAsB;EAC5B,MAAG,CAACD,QAAQ,CAACC,IAAD,CAAZ,EAAmB;EAClB;EACA;;EACD,SAAO,IAAI+B,QAAJ,CAAa/B,IAAb,CAAP,CAJ4B;EAK5B;;ECpEM,SAASuC,SAAT,CAAmB9B,EAAnB,EAAsB;EAC5B,MAAM+B,IAAI,GAAG/B,EAAE,CAACgC,QAAhB,CAD4B;;EAG5B,MAAGD,IAAI,CAACE,KAAR,EAAc;;EAGd,MAAGF,IAAI,CAACpB,OAAR,EAAgB;;EAGhB,MAAGoB,IAAI,CAACxC,IAAR,EAAa;EACZ2C,IAAAA,QAAQ,CAAClC,EAAD,CAAR;EACA;;EACD,MAAG+B,IAAI,CAACI,QAAR,EAAiB;;EAGjB,MAAGJ,IAAI,CAACK,KAAR,EAAc;EAGd;;EAOD,SAASF,QAAT,CAAkBlC,EAAlB,EAAqB;EACpB,MAAIT,IAAI,GAAGS,EAAE,CAACgC,QAAH,CAAYzC,IAAvB,CADoB;;EAEpBA,EAAAA,IAAI,GAAGS,EAAE,CAACqC,KAAH,GAAW,OAAO9C,IAAP,KAAe,UAAf,GAA0BA,IAAI,CAAC+C,IAAL,CAAUtC,EAAV,CAA1B,GAAwCT,IAA1D,CAFoB;EAGpB;EACA;EACA;EAEA;;EACA,OAAI,IAAIE,GAAR,IAAeF,IAAf,EAAoB;EACnBQ,IAAAA,KAAK,CAACC,EAAD,EAAI,OAAJ,EAAYP,GAAZ,CAAL;EACA;;EACDoC,EAAAA,OAAO,CAACtC,IAAD,CAAP;EACA;;ECtCD;EAEA;EACA;EAEA;EACA,IAAMgD,MAAM,iCAAZ;;EACA,IAAMC,YAAY,iBAAUD,MAAV,kBAAwBA,MAAxB,MAAlB;EACA,IAAME,YAAY,GAAG,IAAIC,MAAJ,aAAgBF,YAAhB,EAArB;;EACA,IAAMG,MAAM,GAAG,IAAID,MAAJ,gBAAmBF,YAAnB,YAAf;EACA;;EACA,IAAMI,SAAS,GAAG,4EAAlB;;EACA,IAAMC,aAAa,GAAG,YAAtB;;EACA,IAAMC,YAAY,GAAG,uBAArB;;EAEA,IAAIC,IAAI,GAAC,IAAT;;EACA,IAAIC,aAAJ;;EACA,IAAIC,KAAK,GAAC,EAAV;;EAEA,IAAMC,YAAY,GAAC,CAAnB;EACA,IAAMC,SAAS,GAAC,CAAhB;EAEA;;EAEA,SAASC,gBAAT,CAA0BC,OAA1B,EAAkCC,KAAlC,EAAwC;EACvC,SAAO;EACNC,IAAAA,GAAG,EAACF,OADE;EAENC,IAAAA,KAAK,EAALA,KAFM;EAGNE,IAAAA,IAAI,EAACN,YAHC;EAINO,IAAAA,QAAQ,EAAC,EAJH;EAKNC,IAAAA,MAAM,EAAC;EALD,GAAP;EAOA;;EAED,SAASC,KAAT,CAAeN,OAAf,EAAuBC,KAAvB,EAA6B;EAC5B;EAEA;EACA,MAAIM,OAAO,GAACR,gBAAgB,CAACC,OAAD,EAASC,KAAT,CAA5B;;EACA,MAAG,CAACP,IAAJ,EAAS;EAAE;EACVA,IAAAA,IAAI,GAACa,OAAL;EACA;;EACDZ,EAAAA,aAAa,GAAGY,OAAhB,CAR4B;;EAS5BX,EAAAA,KAAK,CAACY,IAAN,CAAWD,OAAX,EAT4B;EAU5B;;EAED,SAASE,KAAT,CAAeC,IAAf,EAAoB;EACnB;EACAA,EAAAA,IAAI,GAACA,IAAI,CAACC,OAAL,CAAa,KAAb,EAAmB,EAAnB,CAAL;;EACA,MAAGD,IAAH,EAAQ;EACPf,IAAAA,aAAa,CAACS,QAAd,CAAuBI,IAAvB,CAA4B;EAC3BE,MAAAA,IAAI,EAAJA,IAD2B;EAE3BP,MAAAA,IAAI,EAACL;EAFsB,KAA5B;EAIA,GARkB;;EAUnB;;EACD,SAASc,GAAT,CAAaZ,OAAb,EAAqB;EACpB;EACA;EACA,MAAIO,OAAO,GAAGX,KAAK,CAACiB,GAAN,EAAd,CAHoB;;EAKpBlB,EAAAA,aAAa,GAAGC,KAAK,CAACA,KAAK,CAACtB,MAAN,GAAa,CAAd,CAArB,CALoB;EAOpB;EACA;EACA;;EACA,MAAGqB,aAAH,EAAiB;EAChB;EACAY,IAAAA,OAAO,CAACF,MAAR,GAAiBV,aAAjB;EACAA,IAAAA,aAAa,CAACS,QAAd,CAAuBI,IAAvB,CAA4BD,OAA5B;EACA,GAdmB;EAgBpB;;EACA;EAMD;;;EACA,SAASO,SAAT,CAAmBC,IAAnB,EAAwB;EACvB;EACA,SAAMA,IAAN,EAAW;EACV,QAAIC,OAAO,GAAGD,IAAI,CAACE,OAAL,CAAa,GAAb,CAAd;;EACA,QAAGD,OAAO,IAAE,CAAZ,EAAc;EACb;EACA,UAAIE,aAAa,GAAGC,aAAa,EAAjC,CAFa;;EAGb,UAAGD,aAAH,EAAiB;EAChBZ,QAAAA,KAAK,CAACY,aAAa,CAAClB,OAAf,EAAuBkB,aAAa,CAACjB,KAArC,CAAL,CADgB;;EAEhB,iBAFgB;EAIhB;;EACD,UAAImB,WAAW,GAACL,IAAI,CAACM,KAAL,CAAW/B,MAAX,CAAhB;;EACA,UAAG8B,WAAH,EAAe;EACdE,QAAAA,OAAO,CAACF,WAAW,CAAC,CAAD,CAAX,CAAe9C,MAAhB,CAAP;EACAsC,QAAAA,GAAG,CAACQ,WAAW,CAAC,CAAD,CAAZ,CAAH,CAFc;;EAGd;EACA;EACD;;EACD,QAAIV,IAAI,SAAR,CAjBU;;EAmBV,QAAGM,OAAO,IAAE,CAAZ,EAAc;EACbN,MAAAA,IAAI,GAAGK,IAAI,CAACQ,SAAL,CAAe,CAAf,EAAiBP,OAAjB,CAAP;EACA,KArBS;;;EAuBV,QAAGN,IAAH,EAAQ;EACPY,MAAAA,OAAO,CAACZ,IAAI,CAACpC,MAAN,CAAP;EACAmC,MAAAA,KAAK,CAACC,IAAD,CAAL,CAFO;EAGP;EAED,GA9BsB;;;EAgCvB,WAASY,OAAT,CAAiBE,CAAjB,EAAmB;EAClBT,IAAAA,IAAI,GAAGA,IAAI,CAACQ,SAAL,CAAeC,CAAf,CAAP;EACA;;EACD,WAASL,aAAT,GAAwB;EACvB,QAAIb,KAAK,GAAGS,IAAI,CAACM,KAAL,CAAWjC,YAAX,CAAZ,CADuB;EAGvB;EACA;;EACA,QAAGkB,KAAH,EAAS;EACR,UAAOe,KAAK,GAAC;EACZrB,QAAAA,OAAO,EAACM,KAAK,CAAC,CAAD,CADD;EAEZL,QAAAA,KAAK,EAAC;EAFM,OAAb;EAIAqB,MAAAA,OAAO,CAAChB,KAAK,CAAC,CAAD,CAAL,CAAShC,MAAV,CAAP,CALQ;;EAMR,UAAIsC,IAAJ,EAAQa,IAAR,CANQ;EAQR;;;EACA,aAAO,EAAEb,IAAG,GAAGG,IAAI,CAACM,KAAL,CAAW7B,aAAX,CAAR,MAAqCiC,IAAI,GAAGV,IAAI,CAACM,KAAL,CAAW9B,SAAX,CAA5C,CAAP,EAA0E;EACzE;EACA+B,QAAAA,OAAO,CAACG,IAAI,CAAC,CAAD,CAAJ,CAAQnD,MAAT,CAAP;EACA+C,QAAAA,KAAK,CAACpB,KAAN,CAAYO,IAAZ,CAAiB;EAACkB,UAAAA,IAAI,EAACD,IAAI,CAAC,CAAD,CAAV;EAAcpF,UAAAA,KAAK,EAACoF,IAAI,CAAC,CAAD,CAAJ,IAASA,IAAI,CAAC,CAAD,CAAb,IAAkBA,IAAI,CAAC,CAAD;EAA1C,SAAjB,EAHyE;EAIzE;;EACD,UAAGb,IAAH,EAAO;EAAE;EACRU,QAAAA,OAAO,CAACV,IAAG,CAAC,CAAD,CAAH,CAAOtC,MAAR,CAAP;EACA;;EACD,aAAO+C,KAAP;EACA;EACD,GA3DsB;;;EA6DvB,SAAO3B,IAAP;EACA;;;EAED,SAASiC,QAAT,CAAkB1B,KAAlB,EAAwB;EACvB2B,EAAAA,OAAO,CAACC,GAAR,CAAY5B,KAAZ;EACA,MAAI6B,GAAG,GAAC,EAAR;;EACA,OAAI,IAAIzD,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC4B,KAAK,CAAC3B,MAApB,EAA2BD,CAAC,EAA5B,EAA+B;EAC9B,QAAIoD,IAAI,GAAGxB,KAAK,CAAC5B,CAAD,CAAhB;;EACA,QAAGoD,IAAI,CAACC,IAAL,KAAY,OAAf,EAAuB;EAAA;EACtB;EACA,YAAKK,GAAG,GAAC,EAAT;EACAN,QAAAA,IAAI,CAACpF,KAAL,CAAW2F,KAAX,CAAiB,GAAjB,EAAsBzE,OAAtB,CAA8B,UAAA0E,IAAI,EAAE;EAAA,4BACjBA,IAAI,CAACD,KAAL,CAAW,GAAX,CADiB;EAAA;EAAA,cAC9B5F,GAD8B;EAAA,cAC1BC,KAD0B;;EAEnC0F,UAAAA,GAAG,CAAC3F,GAAD,CAAH,GAAWC,KAAX;EACA,SAHD,EAHsB;;EAQtBoF,QAAAA,IAAI,CAACpF,KAAL,GAAW0F,GAAX;EARsB;EAStB,KAX6B;;;EAa9BD,IAAAA,GAAG,cAAOL,IAAI,CAACC,IAAZ,cAAoBQ,IAAI,CAACC,SAAL,CAAeV,IAAI,CAACpF,KAApB,CAApB,MAAH;EACA;;EACD,oBAAWyF,GAAG,CAAC/D,KAAJ,CAAU,CAAV,EAAY,CAAC,CAAb,CAAX,OAlBuB;EAmBvB;;EACD,SAASqE,WAAT,CAAqBC,EAArB,EAAwB;EACvB,MAAIjC,QAAQ,GAAIiC,EAAE,CAACjC,QAAnB;;EACA,MAAGA,QAAQ,CAAC9B,MAAT,GAAgB,CAAnB,EAAqB;EACpB,qBAAU8B,QAAQ,CAACkC,GAAT,CAAa,UAAAC,CAAC;EAAA,aAAIC,GAAG,CAACD,CAAD,CAAP;EAAA,KAAd,EAA0BE,IAA1B,CAA+B,GAA/B,CAAV;EACA,GAFD,MAEK;EACJ,WAAO,KAAP;EACA;EACD;;EACD,SAASC,QAAT,CAAkBL,EAAlB,EAAqB;EACpB,MAAIjC,QAAQ,GAAGgC,WAAW,CAACC,EAAD,CAA1B;EAEA,wBAAcA,EAAE,CAACnC,GAAjB,gBACCmC,EAAE,CAACpC,KAAH,CAAS3B,MAAT,GAAgB,CAAhB,GAAkBqD,QAAQ,CAACU,EAAE,CAACpC,KAAJ,CAA1B,GAAqC,WADtC,SAEGG,QAAQ,cAAKA,QAAL,IAAgB,EAF3B;EAGA;;EACD,SAASoC,GAAT,CAAaG,IAAb,EAAkB;EACjB,MAAGA,IAAI,CAACxC,IAAL,KAAY,CAAf,EAAiB;EAChB;EACA,WAAOuC,QAAQ,CAACC,IAAD,CAAf;EACA,GAHD,MAGK;EACJ,QAAIjC,IAAI,GAAEiC,IAAI,CAACjC,IAAf,CADI;;EAEJ,QAAIkC,MAAM,GAAC,EAAX;EACA,QAAIvB,KAAJ,EAAUwB,KAAV,CAHI;;EAKJ,QAAIC,SAAS,GAAGrD,YAAY,CAACqD,SAAb,GAAuB,CAAvC,CALI;EAMJ;EACA;;EACA,WAAMzB,KAAK,GAAC5B,YAAY,CAACsD,IAAb,CAAkBrC,IAAlB,CAAZ,EAAoC;EACnCmC,MAAAA,KAAK,GAAGxB,KAAK,CAACwB,KAAd;;EACA,UAAGA,KAAK,GAACC,SAAT,EAAmB;EAAG;EACrBF,QAAAA,MAAM,CAACpC,IAAP,CAAY0B,IAAI,CAACC,SAAL,CAAezB,IAAI,CAAC3C,KAAL,CAAW+E,SAAX,EAAqBD,KAArB,CAAf,CAAZ,EADkB;EAElB;;EACDD,MAAAA,MAAM,CAACpC,IAAP,cAAkBa,KAAK,CAAC,CAAD,CAAL,CAAS2B,IAAT,EAAlB,QALmC;;EAMnCF,MAAAA,SAAS,GAACD,KAAK,GAACxB,KAAK,CAAC,CAAD,CAAL,CAAS/C,MAAzB,CANmC;EAOnC;;EACD,QAAGwE,SAAS,GAACpC,IAAI,CAACpC,MAAlB,EAAyB;EACxBsE,MAAAA,MAAM,CAACpC,IAAP,CAAY0B,IAAI,CAACC,SAAL,CAAezB,IAAI,CAAC3C,KAAL,CAAW+E,SAAX,CAAf,CAAZ,EADwB;EAExB;;EAED,wBAAaF,MAAM,CAACH,IAAP,CAAY,GAAZ,CAAb;EACA;EACD;;EAEM,SAASQ,iBAAT,CAA2BC,QAA3B,EAAoC;EAC1C;EACA,MAAIxD,IAAI,GAAGoB,SAAS,CAACoC,QAAD,CAApB,CAF0C;;EAM1C,MAAIC,IAAI,GAAGT,QAAQ,CAAChD,IAAD,CAAnB,CAN0C;EAQzC;EACA;EACA;EACA;EACA;EACA;EACA;EAED;EACA;EACA;EACA;EACA;;EACAyD,EAAAA,IAAI,+BAAwBA,IAAxB,MAAJ;EACA,MAAIC,QAAQ,GAAG,IAAIC,QAAJ,CAAaF,IAAb,CAAf,CAtB0C;EAyB1C;;EACA,SAAOC,QAAP,CA1B0C;EA4B1C;EACA;EAGD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MC/OME;EACJ,mBAAY3G,EAAZ,EAAgB4G,QAAhB,EAA0BC,EAA1B,EAA8BC,OAA9B,EAAuC;EAAA;;EACrC;EACA,SAAK9G,EAAL,GAAUA,EAAV,CAFqC;;EAKrC,SAAK6G,EAAL,GAAUA,EAAV,CALqC;;EAOrC,SAAKE,OAAL,GAAe,EAAf;EACA,SAAKC,MAAL,GAAcJ,QAAd,CARqC;;EAUrC,SAAKE,OAAL,GAAeA,OAAf,CAVqC;;EAarC,SAAKpH,KAAL,GAAa,KAAKS,GAAL,EAAb;EACD;;;;4BACK;EAGJ,UAAMH,EAAE,GAAG,KAAKA,EAAhB;EACA,UAAIN,KAAK,GAAG,KAAKsH,MAAL,CAAY1E,IAAZ,CAAiBtC,EAAjB,EAAqBA,EAArB,CAAZ;EACA,aAAON,KAAP;EACD;;;;6BAEMuH,KAAK;EACV;EACA,WAAKF,OAAL,CAAalD,IAAb,CAAkBoD,GAAlB;EACAA,MAAAA,GAAG,CAACC,MAAJ,CAAW,IAAX;EACD;;;;+BAEQ;EACP,WAAKC,GAAL;EACD;;;4BACK;EACJ;EACAlC,MAAAA,OAAO,CAACC,GAAR;EACD;;;;;;ECtCI,SAASkC,KAAT,CAAeC,OAAf,EAAuBC,KAAvB,EAA6B;EACnCrC,EAAAA,OAAO,CAACC,GAAR,CAAYmC,OAAZ,EAAoBC,KAApB,EADmC;EAInC;;EACA,MAAMC,aAAa,GAACF,OAAO,CAACG,QAA5B;;EACA,MAAGD,aAAH,EAAiB;EAChB,QAAME,MAAM,GAAGJ,OAAf,CADgB;;EAEhB,QAAMK,SAAS,GAAGD,MAAM,CAACE,UAAzB,CAFgB;;EAIhB,QAAIjC,EAAE,GAACkC,SAAS,CAACN,KAAD,CAAhB;EACAI,IAAAA,SAAS,CAACG,YAAV,CAAuBnC,EAAvB,EAA0B+B,MAAM,CAACK,WAAjC,EALgB;;EAMhBJ,IAAAA,SAAS,CAACK,WAAV,CAAsBN,MAAtB,EANgB;;EAOhB,WAAO/B,EAAP;EACA,GAdkC;;EAiBnC;;EACD,SAASkC,SAAT,CAAmBN,KAAnB,EAAyB;EAAA,MACnB/D,GADmB,GACS+D,KADT,CACnB/D,GADmB;EAAA,MACfhE,IADe,GACS+H,KADT,CACf/H,IADe;EAAA,MACVE,GADU,GACS6H,KADT,CACV7H,GADU;EAAA,MACNgE,QADM,GACS6D,KADT,CACN7D,QADM;EAAA,MACGM,IADH,GACSuD,KADT,CACGvD,IADH;;EAGxB,MAAG,OAAOR,GAAP,KAAa,QAAhB,EAAyB;EACxB+D,IAAAA,KAAK,CAAC5B,EAAN,GAASsC,QAAQ,CAACC,aAAT,CAAuB1E,GAAvB,CAAT;EACA2E,IAAAA,gBAAgB,CAACZ,KAAD,CAAhB;EACA7D,IAAAA,QAAQ,CAAC7C,OAAT,CAAiB,UAAAuH,KAAK,EAAE;EAAE;EACzB,aAAOb,KAAK,CAAC5B,EAAN,CAAS0C,WAAT,CAAqBR,SAAS,CAACO,KAAD,CAA9B,CAAP;EACA,KAFD;EAGA,GAND,MAMK;EACJ;EACAb,IAAAA,KAAK,CAAC5B,EAAN,GAASsC,QAAQ,CAACK,cAAT,CAAwBtE,IAAxB,CAAT;EACA;;EACD,SAAOuD,KAAK,CAAC5B,EAAb,CAbwB;EAcxB;EACA;;;EAED,SAASwC,gBAAT,CAA0BZ,KAA1B,EAAgC;EAC/B,MAAIgB,QAAQ,GAAGhB,KAAK,CAAC/H,IAAN,IAAa,EAA5B;EACA,MAAImG,EAAE,GAAG4B,KAAK,CAAC5B,EAAf;;EAEA,OAAI,IAAIjG,GAAR,IAAe6I,QAAf,EAAwB;EACvB,QAAG7I,GAAG,KAAG,OAAT,EAAiB;EAChB,WAAI,IAAI8I,SAAR,IAAqBD,QAAQ,CAACE,KAA9B,EAAoC;EACnC9C,QAAAA,EAAE,CAAC8C,KAAH,CAASD,SAAT,IAAoBD,QAAQ,CAACE,KAAT,CAAeD,SAAf,CAApB;EACA;EACD,KAJD,MAIM,IAAG9I,GAAG,KAAG,OAAT,EAAiB;EACtBiG,MAAAA,EAAE,CAAC+C,SAAH,GAAcH,QAAQ,SAAtB;EACA,KAFK,MAED;EACJ5C,MAAAA,EAAE,CAACgD,YAAH,CAAgBjJ,GAAhB,EAAoB6I,QAAQ,CAAC7I,GAAD,CAA5B;EACA;EACD;EACD;;EChDM,SAASkJ,aAAT,CAAuBC,GAAvB,EAA2B;EACjCA,EAAAA,GAAG,CAACpI,SAAJ,CAAcqI,OAAd,GAAsB,UAASvB,KAAT,EAAe;EACpC,QAAMtH,EAAE,GAAC,IAAT,CADoC;EAGpC;;EACAA,IAAAA,EAAE,CAAC8I,GAAH,GAAO1B,KAAK,CAACpH,EAAE,CAAC8I,GAAJ,EAAQxB,KAAR,CAAZ,CAJoC;EAKpC;EAEA,GAPD;EAQA;EAEM,SAASyB,cAAT,CAAwB/I,EAAxB,EAA2B0F,EAA3B,EAA8B;EACpC,MAAMoB,OAAO,GAAG9G,EAAE,CAACgC,QAAnB,CADoC;;EAEpChC,EAAAA,EAAE,CAAC8I,GAAH,GAAQpD,EAAR,CAFoC;EAIpC;EACA;EACA;EAEA;;EACA,MAAIsD,eAAe,GAAC,SAAhBA,eAAgB,GAAI;EAAE;EACzB;EACAhJ,IAAAA,EAAE,CAAC6I,OAAH,CAAW7I,EAAE,CAACiJ,OAAH,EAAX;EACA,GAHD,CAToC;;;EAcpC,MAAItC,OAAJ,CAAY3G,EAAZ,EAAegJ,eAAf,EAA+B,YAAI,EAAnC,EAAsC,IAAtC,EAdoC;EAepC;EACA;;ECxBO,SAASE,SAAT,CAAmBN,GAAnB,EAAuB;EAC9B;EACAA,EAAAA,GAAG,CAACpI,SAAJ,CAAc2I,KAAd,GAAsB,UAASrC,OAAT,EAAiB;EACtC;EACA,QAAM9G,EAAE,GAAC,IAAT;EACAA,IAAAA,EAAE,CAACgC,QAAH,GAAc8E,OAAd,CAHsC;EAKtC;;EACAhF,IAAAA,SAAS,CAAC9B,EAAD,CAAT,CANsC;EAStC;EACA;EACA;;EACA,QAAGA,EAAE,CAACgC,QAAH,CAAY0D,EAAf,EAAkB;EACjB1F,MAAAA,EAAE,CAACoJ,MAAH,CAAUpJ,EAAE,CAACgC,QAAH,CAAY0D,EAAtB;EACA;EACD,GAfD;;EAiBAkD,EAAAA,GAAG,CAACpI,SAAJ,CAAc4I,MAAd,GAAqB,UAAS1D,EAAT,EAAY;EAChC,QAAM1F,EAAE,GAAG,IAAX;EACA,QAAM8G,OAAO,GAAG9G,EAAE,CAACgC,QAAnB;EACA0D,IAAAA,EAAE,GAAGsC,QAAQ,CAACqB,aAAT,CAAuB3D,EAAvB,CAAL,CAHgC;;EAKhC,QAAG,CAACoB,OAAO,CAACwC,MAAZ,EAAmB;EAClB;EACA,UAAI/C,QAAQ,GAAGO,OAAO,CAACP,QAAvB,CAFkB;;EAGlB,UAAG,CAACA,QAAD,IAAWb,EAAd,EAAiB;EAChBa,QAAAA,QAAQ,GAAGb,EAAE,CAAC6D,SAAd;EACA,OALiB;;;EAOlB,UAAMD,MAAM,GAAGhD,iBAAiB,CAACC,QAAD,CAAhC;EAEAO,MAAAA,OAAO,CAACwC,MAAR,GAAiBA,MAAjB,CATkB;EAWlB;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,KAzB+B;EA2BhC;;;EACAP,IAAAA,cAAc,CAAC/I,EAAD,EAAI0F,EAAJ,CAAd,CA5BgC;EA6BhC,GA7BD;EA8BA;;ECtDM,SAASuC,aAAT,CAAuB1E,GAAvB,EAA+C;EAAA,MAApBhE,IAAoB,uEAAf,EAAe;EACrD,MAAIE,GAAG,GAACF,IAAI,CAACE,GAAb;;EACA,MAAGA,GAAH,EAAO;EACN,WAAOF,IAAI,CAACE,GAAZ;EACA;;EAJoD,oCAATgE,QAAS;EAATA,IAAAA,QAAS;EAAA;;EAKrD,SAAO6D,KAAK,CAAC/D,GAAD,EAAKhE,IAAL,EAAUE,GAAV,EAAcgE,QAAd,EAAuB+F,SAAvB,CAAZ,CALqD;EAQrD;EACM,SAASnB,cAAT,CAAwBtE,IAAxB,EAA6B;EACnC,SAAOuD,KAAK,CAACkC,SAAD,EAAWA,SAAX,EAAqBA,SAArB,EAA+BA,SAA/B,EAAyCzF,IAAzC,CAAZ;EACA;;EAID,SAASuD,KAAT,CAAe/D,GAAf,EAAmBhE,IAAnB,EAAwBE,GAAxB,EAA4BgE,QAA5B,EAAqCM,IAArC,EAA0C;EACzC,SAAO;EACNR,IAAAA,GAAG,EAAHA,GADM;EAENhE,IAAAA,IAAI,EAAJA,IAFM;EAGNE,IAAAA,GAAG,EAAHA,GAHM;EAINgE,IAAAA,QAAQ,EAARA,QAJM;EAKNM,IAAAA,IAAI,EAAJA;EALM,GAAP;EAOA;EAGD;EACA;EAEA;EAEA;;EC5BO,SAAS0F,WAAT,CAAqBb,GAArB,EAAyB;EAC/B;EACA;EACA;EACA;EACAA,EAAAA,GAAG,CAACpI,SAAJ,CAAckJ,EAAd,GAAiB,YAAU;EAC1B,WAAOzB,aAAa,MAAb,SAAiB0B,SAAjB,CAAP,CAD0B;EAE1B,GAFD;;EAGAf,EAAAA,GAAG,CAACpI,SAAJ,CAAcoJ,EAAd,GAAiB,UAAS7F,IAAT,EAAc;EAC9B,WAAOsE,cAAc,CAACtE,IAAD,CAArB;EACA,GAFD;;EAGA6E,EAAAA,GAAG,CAACpI,SAAJ,CAAcqJ,EAAd,GAAiB,UAASC,GAAT,EAAa;EAC7B,WAAOA,GAAG,IAAE,IAAL,GAAU,EAAV,GAAc,QAAOA,GAAP,MAAa,QAAb,GAAsBvE,IAAI,CAACC,SAAL,CAAesE,GAAf,CAAtB,GAA0CA,GAA/D;EACA,GAFD;;EAGAlB,EAAAA,GAAG,CAACpI,SAAJ,CAAcyI,OAAd,GAAsB,YAAU;EAC/B,QAAMjJ,EAAE,GAAC,IAAT;EAD+B,QAGxBsJ,MAHwB,GAGdtJ,EAAE,CAACgC,QAHW,CAGxBsH,MAHwB;EAK/B,QAAIhC,KAAK,GAAIgC,MAAM,CAAChH,IAAP,CAAYtC,EAAZ,CAAb,CAL+B;;EAM/B,WAAOsH,KAAP;EACA,GAPD;EAQA;;ECxBD;;;;;EASA,SAASsB,GAAT,CAAa9B,OAAb,EAAqB;EACpB;EACA,MAAG,CAAC,IAAD,YAAiB8B,GAApB,EAAwB;EAEvB;EACA,GALmB;;;EAOpB,OAAKO,KAAL,CAAWrC,OAAX;EACA;;;EAEDoC,SAAS,CAACN,GAAD,CAAT;EACAa,WAAW,CAACb,GAAD,CAAX;EACAD,aAAa,CAACC,GAAD,CAAb;;;;;;;;"}